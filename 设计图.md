# 随机选择食物系统 - 设计图

## 1. 系统架构图

```mermaid
graph TB
    subgraph "前端层"
        A[index.html<br/>htmx + DaisyUI]
        B[JavaScript模块]
        C[CSS样式]
    end
    
    subgraph "JavaScript模块"
        B1[app.js<br/>主应用逻辑]
        B2[storage.js<br/>数据存储管理]
        B3[github-api.js<br/>GitHub API封装]
        B4[random.js<br/>随机算法]
        B5[utils.js<br/>工具函数]
    end
    
    subgraph "数据存储层"
        D[GitHub仓库<br/>data/foods.json]
        E[localStorage<br/>缓存]
    end
    
    subgraph "外部服务"
        F[GitHub API<br/>Contents API]
    end
    
    subgraph "部署平台"
        G[Cloudflare Pages<br/>全球CDN]
    end
    
    A --> B
    A --> C
    B --> B1
    B --> B2
    B --> B3
    B --> B4
    B --> B5
    B2 --> B3
    B3 --> F
    F --> D
    B2 --> E
    A --> G
    
    style A fill:#e1f5ff
    style B fill:#fff4e6
    style D fill:#f3e5f5
    style E fill:#f3e5f5
    style F fill:#ffccbc
    style G fill:#e8f5e9
```

## 2. 数据流程图

```mermaid
flowchart LR
    subgraph "用户操作"
        A1[添加食物]
        A2[查看列表]
        A3[随机选择]
        A4[删除食物]
        A5[导出数据]
    end
    
    subgraph "htmx处理"
        B1[hx-post]
        B2[hx-get]
        B3[hx-delete]
    end
    
    subgraph "JavaScript处理"
        C1[验证数据]
        C2[更新状态]
        C3[随机算法]
        C4[GitHub API调用]
    end
    
    subgraph "数据存储"
        D1[GitHub仓库<br/>foods.json]
        D2[localStorage<br/>缓存]
    end
    
    subgraph "UI更新"
        E1[更新列表]
        E2[显示结果]
        E3[提示消息]
    end
    
    A1 --> B1
    A2 --> B2
    A3 --> B1
    A4 --> B3
    
    B1 --> C1
    B2 --> C2
    B3 --> C2
    
    C1 --> C2
    C2 --> C3
    C3 --> C4
    
    C4 --> D1
    C4 --> D2
    
    C2 --> E1
    C3 --> E2
    C4 --> E3
    
    D1 -.同步.-> C2
    D2 -.快速读取.-> C2
    
    style A1 fill:#bbdefb
    style A2 fill:#bbdefb
    style A3 fill:#bbdefb
    style A4 fill:#bbdefb
    style A5 fill:#bbdefb
    style C3 fill:#fff9c4
    style C4 fill:#ffccbc
    style D1 fill:#f8bbd0
    style D2 fill:#f8bbd0
```

## 3. 页面结构图

```mermaid
graph TD
    A[今天吃什么 - 主页面]
    
    subgraph "头部区域"
        B[导航栏<br/>应用标题]
    end
    
    subgraph "食物管理区域"
        C1[添加食物表单]
        C2[分类选择器]
        C3[食物名称输入]
        C4[地点输入]
        C5[添加按钮]
        C6[食物列表]
        C7[食物卡片]
        C8[删除按钮]
    end
    
    subgraph "随机选择区域"
        D1[分类选择器]
        D2[随机选择按钮]
        D3[结果显示区]
        D4[重新选择按钮]
    end
    
    subgraph "数据管理区域"
        E1[导出数据按钮]
        E2[清空数据按钮]
        E3[数据状态提示]
    end
    
    subgraph "底部区域"
        F[版权信息]
    end
    
    A --> B
    A --> C1
    A --> D1
    A --> E1
    A --> F
    
    C1 --> C2
    C1 --> C3
    C1 --> C4
    C1 --> C5
    C1 --> C6
    C6 --> C7
    C7 --> C8
    
    D1 --> D2
    D2 --> D3
    D3 --> D4
    
    E1 --> E2
    E2 --> E3
    
    style A fill:#e3f2fd
    style C1 fill:#fff3e0
    style D1 fill:#fff9c4
    style E1 fill:#f1f8e9
```

## 4. 数据模型关系图

```mermaid
erDiagram
    FOOD {
        string id PK
        string name
        string location
        string category FK
        datetime createdAt
        datetime updatedAt
    }
    
    CATEGORY {
        string name PK
        string displayName
    }
    
    APP_STATE {
        array foods
        string currentCategory
        object selectedFood
        boolean isRandomizing
    }
    
    STORAGE {
        string version
        datetime createdAt
        datetime updatedAt
        array foods
        object settings
    }
    
    FOOD ||--o{ CATEGORY : "belongs to"
    APP_STATE ||--o{ FOOD : "contains"
    STORAGE ||--o{ FOOD : "stores"
    
    CATEGORY ||--|| FOOD : "categorizes"
```

## 5. 用户交互流程图

```mermaid
sequenceDiagram
    participant U as 用户
    participant H as HTML/htmx
    participant J as JavaScript
    participant S as Storage
    participant G as GitHub API
    participant L as localStorage
    
    Note over U,L: 添加食物流程
    U->>H: 填写表单并提交
    H->>J: hx-post触发
    J->>J: 验证数据
    J->>S: 保存食物
    S->>G: 更新GitHub仓库
    G-->>S: 返回新SHA
    S->>L: 更新缓存
    S-->>J: 返回成功
    J->>H: 更新DOM
    H-->>U: 显示新食物
    
    Note over U,L: 页面加载流程
    U->>H: 打开页面
    H->>J: 初始化应用
    J->>L: 读取缓存
    L-->>J: 返回缓存数据
    J->>H: 快速显示
    J->>S: 从GitHub同步
    S->>G: 获取最新数据
    G-->>S: 返回数据+SHA
    S->>L: 更新缓存
    S-->>J: 返回最新数据
    J->>H: 更新显示
    H-->>U: 显示最新数据
    
    Note over U,L: 随机选择流程
    U->>H: 选择分类
    U->>H: 点击随机按钮
    H->>J: hx-post触发
    J->>S: 获取分类食物
    S->>L: 读取缓存
    L-->>S: 返回数据
    S-->>J: 返回食物列表
    J->>J: 执行随机算法
    J->>H: 返回结果HTML
    H-->>U: 显示选中食物
    
    Note over U,L: 数据导出流程
    U->>H: 点击导出按钮
    H->>J: hx-get触发
    J->>S: 获取所有数据
    S->>L: 读取数据
    L-->>S: 返回数据
    S-->>J: 返回JSON
    J->>J: 生成文件
    J-->>U: 下载JSON文件
```

## 6. 随机选择算法流程图

```mermaid
flowchart TD
    A[开始随机选择] --> B{是否选择分类?}
    B -->|否| C[提示选择分类]
    B -->|是| D[获取该分类食物列表]
    
    D --> E{列表是否为空?}
    E -->|是| F[提示该分类无食物]
    E -->|否| G[生成随机数]
    
    G --> H[使用Math.random]
    H --> I[计算索引: floor random * length]
    I --> J[获取对应食物]
    
    J --> K[显示动画效果]
    K --> L[展示食物信息]
    L --> M{用户是否重新选择?}
    
    M -->|是| G
    M -->|否| N[结束]
    
    C --> N
    F --> N
    
    style A fill:#c8e6c9
    style G fill:#fff9c4
    style H fill:#fff9c4
    style I fill:#fff9c4
    style K fill:#e1bee7
    style L fill:#e1bee7
```

## 7. 数据存储策略图

```mermaid
flowchart TB
    subgraph "页面加载"
        A1[检查localStorage缓存]
        A2{缓存存在?}
        A3[使用缓存快速显示]
        A4[从GitHub API加载]
        A5[保存SHA值]
        A6[更新缓存]
    end
    
    subgraph "数据操作"
        B1[添加/修改/删除]
        B2[更新AppState]
        B3[调用GitHub API]
        B4[使用SHA更新文件]
        B5[同步到localStorage]
    end
    
    subgraph "离线模式"
        C1{网络可用?}
        C2[使用缓存数据]
        C3[标记为离线模式]
        C4[等待网络恢复]
    end
    
    subgraph "数据导出"
        D1[用户触发导出]
        D2[从缓存读取]
        D3[生成JSON文件]
        D4[下载到本地]
    end
    
    subgraph "多设备同步"
        E1[设备A修改数据]
        E2[推送到GitHub]
        E3[设备B打开页面]
        E4[从GitHub拉取]
        E5[自动同步完成]
    end
    
    A1 --> A2
    A2 -->|是| A3
    A2 -->|否| A4
    A3 --> A4
    A4 --> A5
    A5 --> A6
    
    A6 --> B1
    B1 --> B2
    B2 --> C1
    C1 -->|是| B3
    C1 -->|否| C2
    B3 --> B4
    B4 --> B5
    C2 --> C3
    C3 --> C4
    
    B2 --> D1
    D1 --> D2
    D2 --> D3
    D3 --> D4
    
    E1 --> E2
    E2 --> E3
    E3 --> E4
    E4 --> E5
    
    style A3 fill:#c5e1a5
    style A4 fill:#ffccbc
    style B3 fill:#ffccbc
    style B5 fill:#fff59d
    style C2 fill:#ffab91
    style E5 fill:#90caf9
```

## 8. 组件层次结构图

```mermaid
graph TD
    A[App Root]
    
    subgraph "Layout Components"
        B1[Header]
        B2[Main Container]
        B3[Footer]
    end
    
    subgraph "Feature Components"
        C1[FoodManagement]
        C2[RandomSelector]
        C3[DataManager]
    end
    
    subgraph "FoodManagement Components"
        D1[AddFoodForm]
        D2[CategorySelect]
        D3[FoodList]
        D4[FoodCard]
    end
    
    subgraph "RandomSelector Components"
        E1[CategorySelect]
        E2[RandomButton]
        E3[ResultDisplay]
        E4[Animation]
    end
    
    subgraph "DataManager Components"
        F1[ExportButton]
        F2[ClearButton]
        F3[StatusDisplay]
    end
    
    A --> B1
    A --> B2
    A --> B3
    
    B2 --> C1
    B2 --> C2
    B2 --> C3
    
    C1 --> D1
    C1 --> D2
    C1 --> D3
    D3 --> D4
    
    C2 --> E1
    C2 --> E2
    C2 --> E3
    E3 --> E4
    
    C3 --> F1
    C3 --> F2
    C3 --> F3
    
    style A fill:#e1f5fe
    style C1 fill:#fff3e0
    style C2 fill:#fff9c4
    style C3 fill:#f1f8e9
```

## 9. 部署流程图

```mermaid
flowchart LR
    subgraph "开发环境"
        A1[编写代码]
        A2[配置.env]
        A3[npm run dev]
        A4[本地测试]
    end
    
    subgraph "版本控制"
        B1[Git提交]
        B2[推送到GitHub]
    end
    
    subgraph "Cloudflare Pages"
        C1[自动检测更新]
        C2[配置环境变量]
        C3[npm run build]
        C4[部署dist目录]
        C5[全球CDN分发]
    end
    
    subgraph "生产环境"
        D1[用户访问]
        D2[CDN加速]
        D3[GitHub API读写]
        D4[PWA安装]
    end
    
    A1 --> A2
    A2 --> A3
    A3 --> A4
    A4 --> B1
    
    B1 --> B2
    B2 --> C1
    
    C1 --> C2
    C2 --> C3
    C3 --> C4
    C4 --> C5
    
    C5 --> D1
    D1 --> D2
    D1 --> D3
    D1 --> D4
    
    style A1 fill:#e3f2fd
    style A2 fill:#fff9c4
    style B2 fill:#f3e5f5
    style C2 fill:#ffccbc
    style C3 fill:#fff3e0
    style C5 fill:#c8e6c9
    style D3 fill:#ffccbc
```

## 10. GitHub API 集成架构图

```mermaid
graph TB
    subgraph "前端应用"
        A1[用户界面]
        A2[Storage模块]
        A3[GitHub API模块]
    end
    
    subgraph "环境配置"
        B1[.env文件]
        B2[VITE_GITHUB_TOKEN]
        B3[VITE_GITHUB_OWNER]
        B4[VITE_GITHUB_REPO]
        B5[VITE_GITHUB_BRANCH]
    end
    
    subgraph "GitHub API"
        C1[GET /repos/:owner/:repo/contents/:path]
        C2[PUT /repos/:owner/:repo/contents/:path]
        C3[认证: Bearer Token]
    end
    
    subgraph "GitHub仓库"
        D1[data/foods.json]
        D2[版本历史]
        D3[SHA值]
    end
    
    subgraph "本地缓存"
        E1[localStorage]
        E2[离线模式]
    end
    
    A1 --> A2
    A2 --> A3
    A3 --> B1
    B1 --> B2
    B1 --> B3
    B1 --> B4
    B1 --> B5
    
    A3 --> C3
    C3 --> C1
    C3 --> C2
    
    C1 --> D1
    C2 --> D1
    D1 --> D2
    D1 --> D3
    
    A2 --> E1
    E1 --> E2
    
    D3 -.用于更新.-> C2
    D1 -.同步.-> E1
    
    style A3 fill:#ffccbc
    style B1 fill:#fff9c4
    style C1 fill:#b39ddb
    style C2 fill:#b39ddb
    style D1 fill:#f8bbd0
    style E1 fill:#c5e1a5
```

## 11. 技术栈关系图

```mermaid
graph TB
    subgraph "核心技术"
        A1[htmx 1.9.10<br/>14KB]
        A2[原生JavaScript<br/>ES6+]
        A3[DaisyUI 4.4.0<br/>50KB]
    end
    
    subgraph "样式框架"
        B1[Tailwind CSS<br/>实用类]
        B2[自定义CSS<br/>补充样式]
    end
    
    subgraph "数据存储"
        C1[GitHub API<br/>Contents API]
        C2[GitHub仓库<br/>foods.json]
        C3[localStorage<br/>缓存]
    end
    
    subgraph "构建工具"
        D1[Vite<br/>开发服务器]
        D2[环境变量<br/>.env]
    end
    
    subgraph "PWA支持"
        E1[manifest.json<br/>应用配置]
        E2[service-worker.js<br/>离线支持]
    end
    
    subgraph "部署平台"
        F1[Cloudflare Pages<br/>免费CDN]
    end
    
    A1 --> A2
    A3 --> B1
    B1 --> B2
    
    A2 --> C1
    C1 --> C2
    A2 --> C3
    
    D1 --> D2
    D2 --> A2
    
    E1 --> E2
    E2 --> F1
    
    A1 -.声明式交互.-> B1
    A2 -.API调用.-> C1
    C2 -.同步.-> C3
    D1 -.构建.-> F1
    
    style A1 fill:#e1bee7
    style A2 fill:#fff9c4
    style A3 fill:#b2dfdb
    style C1 fill:#ffccbc
    style C2 fill:#ffccbc
    style D1 fill:#b39ddb
    style F1 fill:#c5e1a5
```

---

## 设计图说明

### 1. 系统架构图
展示了整个应用的层次结构，包括前端层、JavaScript模块、数据存储层和部署平台。

### 2. 数据流程图
描述了用户操作如何通过htmx、JavaScript处理，最终更新数据存储和UI的完整流程。

### 3. 页面结构图
展示了主页面的各个功能区域和组件的层次关系。

### 4. 数据模型关系图
使用ER图展示了食物、分类、应用状态和存储之间的关系。

### 5. 用户交互流程图
使用时序图展示了添加食物、随机选择和数据导出的完整交互流程。

### 6. 随机选择算法流程图
详细描述了随机选择功能的算法逻辑和决策流程。

### 7. 数据存储策略图
展示了基于 GitHub API 的数据加载、操作、持久化和多设备同步的完整策略。

### 8. 组件层次结构图
展示了应用的组件树结构和各组件之间的关系。

### 9. 部署流程图
描述了从开发到生产的完整部署流程，包括环境变量配置和 Vite 构建。

### 10. GitHub API 集成架构图
详细展示了如何通过 GitHub API 进行数据存储、读取和版本控制的完整架构。

### 11. 技术栈关系图
展示了各个技术组件之间的依赖和协作关系，包括 GitHub API 集成。
